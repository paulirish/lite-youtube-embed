<!DOCTYPE html>
<title>poster image availability</title>

<body>



</body>


<style>
  img,
  picture {
    max-height: 120px;
    max-width: 120px;
  }

  thead {
    position: sticky;
    top: 0;
    background: #ffffffd4;
  }

  td {
    background: #eee;
  }
</style>

<script>

/* resulst!!!!!
{
  "maxresdefault.webp (1280px)": 178,
  "sddefault.webp (640px)": 21,
  "hqdefault.webp (480px)": 8,
  "maxresdefault.jpg (1280px)": 6
  "sddefault.jpg (640px)": 2,
  "hqdefault.jpg (480px)": 89,
}
*/

  const sizes = [
    'maxresdefault', // 1280px
    'sddefault', // 640px
    'hqdefault', // 480px (lol, naming is hard)
    'mqdefault', // 320px
    'default', // 120px
  ];
  const sizePxs = ['1280px', '640px', '480px', '320px', '120px'];

  const createChild = (tagName, container) => container.appendChild(document.createElement(tagName));


  document.addEventListener('DOMContentLoaded', _ => {

    const table = createChild('table', document.body);
    const thead = createChild('thead', table);
    const tbody = createChild('tbody', table);

    // headers
    const tr = createChild('tr', thead);
    createChild('th', tr).textContent = 'video id';
    createChild('th', tr).textContent = 'best!?';
    for (const size of sizes) {
      createChild('th', tr).textContent = size;
    }
    const tr2 = createChild('tr', thead);
    createChild('th', tr2);
    createChild('th', tr2);
    for (const px of sizePxs) {
      createChild('th', tr2).textContent = px;
    }

    // rows
    ids.forEach(videoid => {
      const tr = createChild('tr', tbody);
      createChild('td', tr).textContent = videoid;


      const bestEl = createChild('td', tr);
      const updateBest = (sizeIndex, format, e) => {
        // A pretty ugly hack since onerror won't fire on YouTube image 404. This might be due to the fact that
        // YouTube returns data to the request even when the status is 404. YouTube returns a placeholder image that is 120x90.
        // â€¦ per amp-youtube comments: https://github.com/ampproject/amphtml/blob/186d10a0adadcc8367aaa047b58598b587958946/extensions/amp-youtube/0.1/amp-youtube.js#L496-L527
        const noAvailableThumbnail = e.target.naturalHeight == 90 && e.target.naturalWidth == 120;
        if (noAvailableThumbnail) return;

        bestEl.loaded = bestEl.loaded ?? [];
        const formatIndex = { webp: 100, jpg: 110 }[format];
        const sum = formatIndex + sizeIndex;
        bestEl.loaded.push({ sum, format, sizeIndex });
        bestEl.loaded.sort((a, b) => a.sum - b.sum);
        const bestObj = bestEl.loaded.at(0);
        bestEl.textContent = `${sizes[bestObj.sizeIndex]}.${bestObj.format} (${sizePxs[bestObj.sizeIndex]})`;
      };

      // all combos. verbose
      sizes.forEach((size, i) => {
        const td = createChild('td', tr);
        const imgWebp = createChild('img', td);
        imgWebp.src = `https://i.ytimg.com/vi_webp/${videoid}/${size}.webp`;
        imgWebp.onload = e => { updateBest(i, 'webp', e) };
        createChild('br', td)
        const imgJpg = createChild('img', td);
        imgJpg.src = `https://i.ytimg.com/vi/${videoid}/${size}.jpg`;
        imgJpg.onload = e => { updateBest(i, 'jpg', e) };
      });


      // justinribeiro-lite-youtube does this picture/source/srcset appraoch but.. it doesnt automatically fall through to the non 404s. so.. not for me.  example failing ID: 5BueilOHIws
      // const td = createChild('td', tr);
      // const picture = createChild('picture', td);
      // const webpSource = createChild('source', picture);
      // const jpegSource = createChild('source', picture);
      // webpSource.type = "image/webp";
      // jpegSource.type = "image/jpeg";
      // const fallbackImg = createChild('img', picture);
      // fallbackImg.loading = 'lazy'; // ?  also...  referrerpolicy="origin"   ?
      // webpSource.srcset = `https://i.ytimg.com/vi_webp/${videoid}/hqdefault.webp`;
      // jpegSource.srcset = fallbackImg.src = `https://i.ytimg.com/vi/${videoid}/hqdefault.jpg`;

    });
  });

  // Count our winners
  onload = _ => {
    Object.countBy = (items, groupByFn) => Object.fromEntries(
      Object.entries(Object.groupBy(items, groupByFn)).map(([k, v]) => [k, v.length])
    );

    const allBests = Array.from(document.querySelectorAll('tbody td:nth-child(2)')).map(e => e.textContent);
    const bestsCounted = Object.countBy(allBests, i => i);
    const pre = createChild('pre', document.body);
    document.body.prepend(pre)
    pre.textContent = JSON.stringify(bestsCounted, null, 2)
  }

  /**
   * Get a bunch of ids from a YT page with:
   *     copy(Array.from(new Set(Array.from(document.querySelectorAll('a.ytd-thumbnail')).map(e => e.href).filter(Boolean).map(h => { const u = new URL(h); return u.searchParams.get('v'); }))))
   */
  const ids = [
  "3zaq56QsX28",
  "ajGX7odA87k",
  "-hKK4_gvOS0",
  "5BueilOHIws",
  "saaTXQ7E3Lw",
  "bJcTWr8-mFo",
  "jWur1VrxNUg",
  "b52cfb6lweU",
  "svEuG_ekNT0",
  "IZREy3QRwVc",
  "XoEZvSl5Cg8",
  "b84CjOgkIBE",
  "ViyTYEv9dM8",
  "JSkNlhBJWvA",
  "CHDl-Zv-0l0",
  "PUwmA3Q0_OE",
  "Mh5LY4Mz15o",
  "BHD3uqfbcRQ",
  "qsWl1--Niyg",
  "wUrejjlbISs",
  "3KszJHdraSY",
  "fnb7EqfykF4",
  "HSQ03mfV5ms",
  "CcISIVoSZGQ",
  "f7AU2Ozu8eo",
  "_XLGYxeL1iQ",
  "yHV04eSGzAA",
  "3MV1iwUVzJ0",
  "WRE6ssTulcI",
  "p9kfcEga0lk",
  "E6x_-xKl-Fg",
  "H0TBZeCgL0E",
  "2XlTjeNHv-8",
  "m4v4TMqrbhE",
  "u6XAPnuFjJc",
  "D6vdD5HOSgw",
  "_mG1vIeETHc",
  "3mZ1zV1l2KQ",
  "lQKdEdzHnfU",
  "IUKslRdPvbY",
  "0dw47fZLpSw",
  "qciVXUHTN10",
  "tgz9rzPgVWY",
  "euTu04297sI",
  "qDiDATbIG-o",
  "K4btw_3U5Hk",
  "-Sgj78QG9Bg",
  "0L1hD5OlPtw",
  "3Ul5ag1unCg",
  "zSgiXGELjbc",
  "Fwvc6fmXmuY",
  "-wa0umYJVGg",
  "WaYvYysQvBU",
  "ohmhZVjaqQo",
  "oRTVcSZF2zM",
  "EjW2Np3Z6so",
  "9sRo80A-ZpU",
  "D2FX9rviEhw",
  "F8VyOuJ8Uak",
  "N_AaXKQZbXY",
  "FtX8nswnUKU",
  "MuU00Q3RhDg",
  "fb6o8VWW3e4",
  "HTYeuo6pIjY",
  "IZ4LCejQg8o",
  "Zcc8gE54Md8",
  "CZrr7AZ9nCY",
  "GlNyCHlLt1Y",
  "FAVuK5efP4Q",
  "cqJFZI7YWzM",
  "ok3ykR2GHCc",
  "1maJZ0U8ULg",
  "b0Ti-gkJiXc",
  "GsT8fmWRlIk",
  "O_DrFTM5JHQ",
  "Bkp9bDGDd1w",
  "2w6uMqXfP7g",
  "25w1XzWUWwc",
  "PH6xCT2aTSo",
  "gBfngOsvmA0",
  "2SoZzlgQzHM",
  "uYZy9eRazVw",
  "GZUaXDm4qik",
  "DrapiUmMsmM",
  "dT4Fu-XDygw",
  "jDzN_GwJfG0",
  "_OBlgSz8sSM",
  "jmR0V6s3NKk",
  "WEj7xpZE7uc",
  "v31qxrXsxv0",
  "ECrr_szK8es",
  "90BPA2l8MbI",
  "PJupNDIKkEk",
  "M90rc546doo",
  "VjE0Kdfos4Y",
  "e-yldqNkGfo",
  "0ONJfp95yoE",
  "lLYD_-A_X5E",
  "zvKbv3FNW00",
  "hsF0Eqs8yQ8",
  "pWe7wTVbLUU",
  "ddO9idmax0o",
  "QsTqspnvAaI",
  "Ryas9OANw-E",
  "dsU3B0W3TMs",
  "eTosQerWBzU",
  "vvlCu1_noTc",
  "h7quH25cszo",
  "GUHLa1qSy24",
  "yqoFwZUp5vc",
  "7CoJGrtVs4c",
  "SKOwCjqwamo",
  "hpfYt7vRHuY",
  "caIBKOztlAo",
  "17ojj7tgrqw",
  "1WxP6MGvO_s",
  "jrC8RkVKaPY",
  "sssQ_wrNo2A",
  "8WDBtxFUdu4",
  "C_A7Hu0uKNw",
  "y5yPh8trI9k",
  "y8k4Nt0rV5c",
  "eRlhKaxcKpA",
  "lj3iNxZ8Dww",
  "ymfE1MOTXDk",
  "hMnk7lh9M3o",
  "lZh9nmKJhv0",
  "Ny8QwQTk7Zo",
  "WGOohBytKTU",
  "Qgj7Z52616Y",
  "D35uQCtr4EY",
  "JQzg3gzTfhY",
  "MqDAf_lg9Xs",
  "vL7FcvEydqg",
  "IVrlA3-f29g",
  "ZzthPJfTxPQ",
  "gzBtdFwx97Q",
  "crEz8i6oVpI",
  "thH3VrYcGrA",
  "M7-h3FO-KKo",
  "o_5xrPCMwpE",
  "4vdUb87OudU",
  "wD9gHJnxLV0",
  "bXEaUAWHU0Y",
  "SI3I8qw7rhg",
  "kt2mtS7VTG4",
  "2sRvgsJbKgI",
  "eNp9-m3iCZg",
  "oxQBrBY_VAs",
  "1Y1kJpHBn50",
  "0h7AjDtk6Y4",
  "IoL8g0W9gAQ",
  "v4seDVfgwOg",
  "Lloo1Ksr3ms",
  "6IIFmsmpjLM",
  "tE2mZ_t_mts",
  "osd9AKRCFRM",
  "kBpv__QvYd0",
  "kavxsXhzD48",
  "qAF971SUZEM",
  "2JTb96-Y-Pk",
  "1aQpedzFOHA",
  "4ba9Nw4zdBY",
  "YShw39LCK3I",
  "geitZHvojOM",
  "XFBrPzr2D1U",
  "Lyt45PvNi2Q",
  "erl4hN4W1bM",
  "KY0_EOJIRF8",
  "KOYH55FoPJc",
  "3As5bEJ1WT0",
  "WlVjmI62qbw",
  "E3Wcch4sapo",
  "lKQWECx4OVQ",
  "QNIXlWDTWzE",
  "RIWfH3iEgXU",
  "pU6Ki6iJ6qQ",
  "e7MZqCsQJKw",
  "I9uVg-feZoM",
  "7t5l7sjcjHU",
  "zDEcvSc2UKA",
  "JNMgeE90q7c",
  "jKUBYGwoW3A",
  "DDH4m6M-ZIU",
  "I9UeCJgiGLA",
  "mWZipukcDd4",
  "3zf2cfwjzg4",
  "swk3IjxzZB4",
  "Zvq9pybXg-4",
  "y-PxmQn8Xr8",
  "0u1uv9tpXTQ",
  "bPgNla5kq48",
  "-G8R_zjx1Yw",
  "8M8P5-6yla0",
  "_160oMzblY8",
  "Iga8Fd5Y4q8",
  "aKwJayXTZUs",
  "5_2sgrL0_Nc",
  "UO-8CMdeSHA",
  "2f-YkxuaoNA",
  "wsSMmdwh89Y",
  "B38CY-4Rd6s",
  "kjPu1G-YNjw",
  "6UFKbas98Rg",
  "ZMp0VwztcNw",
  "YqeW9_5kURI",
  "gz_271z1A2U",
  "Beld090NIoo",
  "ZhCKs7DDePM",
  "tSDsi2ItktY",
  "Xfi0sYR-hZQ",
  "rjo8h5qLpU0",
  "2AZ0I6tFvgg",
  "zqq9bEu3kGY",
  "vRCjsuXBVQU",
  "1nkgTtTWnPM",
  "4DdNQ4bxgTQ",
  "wK7TiA9qmuU",
  "tHJwRWrexqg",
  "6R7GkXE6sqk",
  "93zmmhb7nxI",
  "lXKDu6cdXLI",
  "IoXiXlCNoXg",
  "cvFt2Xcuois",
  "QrVuW5RtaRE",
  "9qFy9JiRrFI",
  "SdL55HWNPRM",
  "mraZhMwqTww",
  "3-GdTvkLUFA",
  "nCwwVjPNloY",
  "4LvaX748pVI",
  "zZqxPozl2Ec",
  "WjkRHgY0yZg",
  "WdtkaLxc464",
  "ZCP3v6Z7D58",
  "kfPNxNIDHrA",
  "VnAaokoy8QA",
  "8vnHJNjwuqg",
  "MASAqbRMnaM",
  "DpefYPLH67A",
  "Cx8AaSvH4EQ",
  "xb1u_hnlliY",
  "GzUUghxDhYM",
  "uoshHrKSlj0",
  "LjfAkgZlhIo",
  "QmrjoKJ4s58",
  "4QsEPEhq5yk",
  "Xjexl9ZRvk0",
  "cfFU78tHO6I",
  "TMgiZkICjMA",
  "TAmN7RjUzCU",
  "9tZmSFjoOm4",
  "5K65xwSXlUw",
  "XeI1r5sn8fY",
  "USBboeK7oDA",
  "aEPnznv-eEo",
  "eoMy-5LvJMY",
  "mPjgRKW_Jmk",
  "oWGWzFWq2Zs",
  "evp0dI_2JJc",
  "NnSoqWDfPAw",
  "gXZeDXmwSQU",
  "r2LpOUwca94",
  "GWmO88hBbKY",
  "4xXgsMFYzHw",
  "Z6R0NvVr164",
  "j9TrSkLZa5A",
  "aMxhM1Q-VQ4",
  "Ro7l-82exQk",
  "lusUCg1TMv8",
  "Zr1ecjYFYTo",
  "otcmcNY-3pk",
  "b6utueP-zsU",
  "nJ0aFq1ve0M",
  "ndEmtXC1WJc",
  "n_7gkhSjSjY",
  "SPbijgSYe_4",
  "hAQJ9bNENyA",
  "_M608ceGry4",
  "Gs4qo2_3IEo",
  "pvuN_WvF1to",
  "d98CAgQNeaM",
  "OI3shBXlqsw",
  "YzUQdtzcyfM",
  "AIT439t5SZo",
  "t3duz5KGyaM",
  "35k3TLzmh2o",
  "ZMQbHMgK2rw",
  "qubPzBcYCTw",
  "pKlK1w5Nhtw",
  "B1J2RMorJXM",
  "IH1GfT2R6Xc",
  "-4NXxY4maYc",
  "5u7euN1HTuU",
  "OIyOEuQQsCQ",
  "zygOA6HiMoA",
  "TVM5Yy6lBjM",
  "P7cgX5XBDaU",
  "A5w-dEgIU1M",
  "XVdq1bYkTeA",
  "cIQ9IXSUzuM",
  "TTQJ5jOTJJA",
  "FTP7vHRBYNA",
  "Bn7qIl59MAQ"
]
</script>